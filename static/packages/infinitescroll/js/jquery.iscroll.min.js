(function(a){a.iscroll={defaults:{debug:false,padding:50,loader:'<div class="loader"></div>',pageBlock:"ul.pagination",pageSelector:'li a[data-item="true"]',total_page:null,placeholder:"",page_place:"page_place",dataType:"html",beforeSend:null,afterSend:null,container:".container"}};var b=function(f,h){var p=f.data("iscroll"),o=(typeof h==="function")?{callback:h}:h,q=a.extend({},a.iscroll.defaults,o,p||{}),v=a(window),j=a(document),e=a(q.container),d=a('<div class="iscroll-loader">').append(q.loader),t=f.find(".iscroll-inner").length?f.find(".iscroll-inner"):null,r=function(){if(t===null){t=a("<div>",{style:"display:none;","class":"iscroll-inner"});t.data("iscroll",{next:2});f.contents().wrapAll(t)}},l=function(){g("info","iScroll","Destroy");$eventList.remove("scroll","iscroll:scroll");f.removeData("iscroll")},n=function(){if(q.total_page===null){q.total_page=parseInt(f.data("max"))}if(q.placeholder==""){q.placeholder=f.find(q.pageBlock).data("placeholder")}if(q.total_page<2){return false}r();return true},k=function(){var x=f.data("iscroll"),w=Math.ceil(v.scrollTop()+v.height()+q.padding);if(!x.waiting&&w>=j.height()){g("info","iScroll:",w-j.height(),"from bottom. Loading next request...");return u()}return false},m=function(){$eventList.add("scroll","iscroll:scroll");a(window).off("iscroll:scroll").on("iscroll:scroll",function(){k()});k()},u=function(){var w=f.data("iscroll");w.waiting=true;a.ajax({url:i(true),dataType:q.dataType,beforeSend:function(){if(q.beforeSend!==null){q.beforeSend(link,f)}else{f.append(d)}},success:function(x){if(q.afterSend!==null){q.afterSend(x,f)}else{e.append(x)}w.waiting=false;s()},error:function(){w.waiting=false}})},s=function(){d.remove();var w=t.data("iscroll");w.next++;if(w.next>q.total_page){l()}},g=function(w){if(q.debug&&typeof console==="object"&&(typeof w==="object"||typeof console[w]==="function")){if(typeof w==="object"){var y=[];for(var x in w){if(typeof console[x]==="function"){y=(w[x].length)?w[x]:[w[x]];console[x].apply(console,y)}else{console.log.apply(console,y)}}}else{console[w].apply(console,Array.prototype.slice.call(arguments,1))}}},i=function(){return q.placeholder.replace(new RegExp(q.page_place,"g"),t.data("iscroll").next)};this.destroy=function(w){l()};if(!n()){return false}g("info","iScroll","Start init.");f.data("iscroll",a.extend({},p,{initialized:true,waiting:false}));m();return this};var c=[];a.fn.iScroll=function(d){if(d==="removeAll"){a.each(c,function(f,e){e.destroy(d)});c=[];return}this.each(function(){var f=a(this),e=f.data("iscroll"),g;if(e&&e.initialized){return}g=new b(f,d);if(g!==false){c.push(g)}});return c}}(jQuery));