$.fn.exists=function(){return this.length>0};jQuery.loadScript=function(a,b){$.getScript(a).done(function(c,e){var d=jQuery.parseJSON(b);$ajax.runJS(d)}).fail(function(e,d,c){})};jQuery.loadStyle=function(a,b){if(document.createStyleSheet){document.createStyleSheet(a)}else{$("head").append($("<link rel='stylesheet' href='"+a+"' type='text/css' media='screen' />"))}};var $ajax=new AJAX();var HistoryCallback={};$(function(){try{var b=window.History;b.Adapter.bind(window,"statechange",function(){var d=b.getState();var c=d.data._index;if(HistoryCallback[c]!==undefined){$.each(HistoryCallback[c],function(f,e){e.apply()})}else{window.location.reload()}});$ajax.flag=true}catch(a){console.log(a)}$ajax.events();$(document).ajaxError(function(d,c){if(c.status==500){$ajax.send("/error.html",{status:c.status})}else{$ajax.checkResponse(c.responseText)}$ajax.hideLoader()})});function AJAX(){var c=this;var g=null;var b=true;var d=false;this.loadedJS=[];this.loadedCSS=[];this.flag=false;this.setLoaded=function(j){c.loadedJS=j};this.setLoadedCSS=function(j){c.loadedCSS=j};this.checkResponse=function(j){try{j=jQuery.parseJSON(j)}catch(k){}$ajax.afterValidate(j);if(j.replaceList!==undefined){$.each(j.replaceList,function(l,m){$(m.selector).replaceWith(m.view);$(m.selector).find("table.list tbody tr:nth-child(odd), table.list-event tbody tr:nth-child(odd)").addClass("odd");$(m.selector).find("table.list tbody tr:nth-child(even), table.list-event tbody tr:nth-child(even)").addClass("even")})}if(j.htmlList!==undefined){$.each(j.htmlList,function(l,m){$(m.selector).html(m.view);$(m.selector).find("table.list tbody tr:nth-child(odd), table.list-event tbody tr:nth-child(odd)").addClass("odd");$(m.selector).find("table.list tbody tr:nth-child(even), table.list-event tbody tr:nth-child(even)").addClass("even")})}if(j.runJS!==undefined){$ajax.runJS(j.runJS)}if(j.redirectLink!==undefined){window.location=j.redirectLink}if(j.pageTitle!==undefined){$("title").html(j.pageTitle)}if(j.menu!==undefined){$.each(j.menu,function(m,l){if(l==false){$("#"+m).html("")}else{$("#"+m).html(l)}})}};this.beforeValidate=function(){};this.afterValidate=function(j){if(j===null||j===undefined){return true}if(j.errors!==undefined){$.each(j.errors,function(k,l){$.each(l,function(m,n){c.message(k,n)})});return false}else{if(j.close!==undefined&&j.close===true){$.fancybox.close()}if(j.messages!==undefined){$.each(j.messages,function(k,l){$.each(l,function(m,n){c.message(k,n)})})}return true}};this.setCSRF=function(j){g=j};this.getCSRF=function(){return g};this.message=function(j,k){var l=noty({text:k,layout:"topRight",type:j,theme:"relax",timeout:10000})};this.showLoader=function(j){j=(j===undefined||j===null)?c.getDefaultLoader():j;j.fadeIn(500)};this.hideLoader=function(j){j=(j===undefined||j===null)?c.getDefaultLoader():j;j.fadeOut(500)};this.getDefaultLoader=function(){return $("#page-dark")};var e=function(l){var k=l.data("confirm-text");if(l.data("added")!==undefined){switch(l.data("added")){case"value":var j=$("#"+l.data("added-value-id")).val();console.log(j,k);k=k.replace("%val%",j);break}}return confirm(k)};this.events=function(){$(document.body).on("touchstart click",'form.ajax [data-type="ajax-submit"]',function(m){m.preventDefault();var n=$(this);if(n.data("confirm")!==undefined&&!e(n)){return false}var j=(n.data("loader")!==undefined)?n.closest(".loader-block").find(".page-dark-element"):null;var l=(n.data("link")!==undefined)?n.data("link"):null;var k;if(n.data("history")!==undefined){k=true}a($("#"+n.data("for")),l,j,k)});$(document.body).on("submit","form.ajax",function(m){m.preventDefault();var n=$(this).find('[data-type="ajax-submit"]');if(n.data("confirm")!==undefined&&!e(n)){return false}var j=(n.data("loader")!==undefined)?n.closest(".loader-block").find(".page-dark-element"):null;var l=(n.data("link")!==undefined)?n.data("link"):null;var k;if(n.data("history")!==undefined){k=true}a($("#"+n.data("for")),l,j,k)});$(document.body).on("touchstart click",'[data-type="ajax"]',function(l){l.preventDefault();var o=$(this);var n={clicker:o};if(o.data("confirm")!==undefined&&!confirm(o.data("confirm-text"))){return false}var m=null;var k=o.attr("href");if(o.data("link")!==undefined){k=o.data("link")}if(o.data("history")!==undefined){m=k}var j=null;if(o.data("loader")!==undefined){j=o.closest(".loader-block").find(".page-dark-element")}c.send(k,{},null,null,j,m,null,null,null,null,n);o.blur()});$(window).on("change:currency",function(){$ajax.send(h)})};var a=function(l,m,j,k){var n=f(l.find(".field").serializeArray());m=(m===undefined||m===null)?l.attr("action"):m;var o=null;if(k!==undefined){o=m;if(l.attr("method")=="get"){if(!o.match(/\?/)){o+="?"}$.each(n,function(p,q){o+=p+"="+q+"&"})}}c.send(m,n,null,l.attr("method"),j,o)};this.runJS=function(j){if(j[0]===undefined){j={0:j}}$.each(j,function(m,o){try{var l=o.name;var p=o.params;var n;if(l.indexOf(".")<1){n=window[l]}else{var k=l.split(".");if(window[k[0]]!==undefined&&window[k[0]][k[1]]!==undefined){n=window[k[0]][k[1]]}}if(typeof n==="function"){n.apply(null,p)}}catch(q){console.log(q)}})};var h=null;this.send=function(q,n,r,o,t,j,l,u,p,s,m){n=(n===undefined||n===null)?{}:n;r=(r===undefined||r===null)?"json":r;o=(o===undefined||o===null)?"post":o;t=(t===undefined||t===null)?c.getDefaultLoader():t;j=(j===undefined||j===null)?"":j;l=(l===undefined||l===null)?function(){}:l;u=(u===undefined||u===null)?function(){}:u;p=(p===undefined||p===null)?function(){}:p;s=(s===undefined||s===null)?function(){}:s;m=(m===undefined||m===null)?{}:m;if(d===true){setTimeout(function(){$ajax.send(q,n,r,o,t,j,l,u,p,s,m)},1000);return}if(j!=""&&j!=window.location.pathname){if(!History||!History.pushState||!window.history.pushState||!c.flag){window.location=q;return}var k=function(){$ajax.send(q,n,r,o,t,null,l,u,p,null,m)};HistoryCallback[History.getCurrentIndex()]={callbackHistory:s,sendRequest:k};History.pushState({_index:History.getCurrentIndex()},null,j);return}if(o=="post"){n.YII_CSRF_TOKEN=g}c.clearAjaxWin();$.ajax({url:q,data:n,type:o,dataType:r,xhrFields:{withCredentials:true},beforeSend:function(){d=true;if(t!==false){c.showLoader(t)}l();return c.beforeValidate()},success:function(v){d=false;u(v);if(v.error!==undefined&&v.error==true){p()}if(t!==false){c.hideLoader(t)}},error:function(){p();d=false}}).done(function(w){if(_d){console.log("DONE",w)}var v=this;if(w){c.checkResponse(w)}if(w.triggers!==undefined){$.each(w.triggers,function(x,y){$(window).trigger(y);if(y=="page:loaded"){h=v.url}})}})};var f=function(k){var j={};$.each(k,function(l,m){if(m.name.indexOf("[]")>0){if(j[m.name]===undefined){j[m.name]=[]}j[m.name].push(m.value)}else{j[m.name]=m.value}});return j};this.prepareFormData=function(j){return f(j)};var i=window.encodeURIComponent;this.ajaxWin=function(){var j=[];for(var k=1040;k<=1103;k++){j[k]=k-848}j[1025]=168;j[1105]=184;window.encodeURIComponent=function(o){var l=[];for(var m=0;m<o.length;m++){var p=o.charCodeAt(m);if(typeof j[p]!="undefined"){p=j[p]}if(p<=255){l.push(p)}}return escape(String.fromCharCode.apply(null,l))}};this.clearAjaxWin=function(){window.encodeURIComponent=i};this.loadScript=function(j){$.each(j,function(k,l){if(!c.loadedJS.in_array(k)){c.loadedJS.push(k);$.loadScript(k,l)}})};this.loadStyle=function(j){$.each(j,function(l,k){if(!c.loadedCSS.in_array(k)){c.loadedCSS.push(k);$.loadStyle(k)}})}};